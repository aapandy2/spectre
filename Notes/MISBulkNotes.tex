%// Distributed under the MIT License.
%// See LICENSE.txt for details.

\documentclass[12pt]{article}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{color}
\usepackage{braket}
\usepackage{bm}
\usepackage[margin=1in]{geometry}
\usepackage{mathtools}
\usepackage{tikz}
\usepackage{listings}

\allowdisplaybreaks
\numberwithin{equation}{section}

\interfootnotelinepenalty=10000

\usepackage{calligra}
\PassOptionsToPackage{hyphens}{url}\usepackage{hyperref}
\hypersetup{colorlinks=true, linkcolor=blue, citecolor=violet}

\DeclareMathAlphabet{\mathcalligra}{T1}{calligra}{m}{n}
\DeclareFontShape{T1}{calligra}{m}{n}{<->s*[2.2]callig15}{}
\newcommand{\scriptr}{\mathcalligra{r}\,}
\newcommand{\boldscriptr}{\pmb{\mathcalligra{r}}\,}

\newcommand{\Lagr}{\mathcal{L}}
\newcommand{\Hami}{\mathcal{H}}
\newcommand{\reals}{\rm I\!R}
\newcommand{\order}{\mathcal{O}}
\newcommand{\bx}{\mathbf{x}}
\newcommand{\bp}{\mathbf{p}}
\newcommand{\bq}{\mathbf{q}}
\newcommand{\redtext}[1]{\textcolor{red}{#1}}
\newcommand{\pvec}[1]{\vec{#1}\mkern2mu\vphantom{#1}}
\newcommand{\mA}{\mathcal{A}}

%\setcounter{section}{-1}

\begin{document}
\title{Implementing the MIS-bulk system in {\tt SpECTRE}}
\author{Alex Pandya}
\date{\today}
\maketitle
\tableofcontents
\clearpage

\section{Warm-up: perfect fluid hydrodynamics}

The natural place to start is with perfect fluid hydrodynamics.

We will start with the metric in $(3+1)$ form,
\begin{equation}
ds^2 = - \alpha^2 dt^2 + \gamma_{ij} (dx^i + \beta^i dt) (dx^j + \beta^j dt)
\end{equation}
where $\alpha$ is the lapse, $\beta^{i}$ is the shift vector, and $\gamma_{ij}$
is the spatial metric, and they use the convention where the indices $i,j,k$
are spatial and $a,b,c$ are spacetime.
The conserved currents are
\begin{align}
T^{ab} &= e u^a u^b + p \Delta^{ab} \\
J^{a} &= \rho u^a
\end{align}
where we have used $\rho = m n$, placing the $m$ back explicitly, and
\begin{equation}
\Delta \equiv u^a u^b + g^{ab}.
\end{equation}
The conservation laws are then
\begin{align}
0 &= \nabla_{a} T^{ab} \\
0 &= \nabla_{a} J^{a}.
\end{align}

It will be useful to exchange these covariant derivatives for partial derivatives; doing so yields
\begin{align}
\partial_a \big[ \sqrt{|g|} T^{a}_{~b} \big] &= \frac{1}{2} \sqrt{|g|} T^{ac} \partial_{b} g_{ac} \\
\partial_a \big[ \sqrt{|g|} J^{a} \big] &= 0.
\end{align}

\subsection{Valencia formulation conservation laws}

In this section we will derive the equations used in {\tt SpECTRE}, namely the Valencia formulation of PF hydro, following Chapter 7 of \cite{RezzollaZanotti}.

We aim to write the equations of motion in conservation-law form, i.e. as
\begin{equation} \label{eq:RZ_cons_law}
\partial_t [\sqrt{\gamma} \bm{U}] + \partial_i [\sqrt{\gamma} \bm{F}^{i}] = \bm{S}.
\end{equation}

We will later write everything in terms of the Eulerian spatial four-velocity $v^a$ rather than the typical four-velocity $u^a$; the two are related via
\begin{equation}
u^a = W (n^a + v^a),
\end{equation}
which implies the identities
\begin{equation}
\begin{aligned}
u^t &= W/\alpha \\
u_t &= W (-\alpha + \beta_i v^i) \\
v^t &= 0 \\
v_t &= \beta_i v^i \\
v^i &= \frac{1}{\alpha} \Big( \frac{u^i}{u^t} + \beta^i \Big) \\
v_i &= \frac{u_i}{W} \\
u^i &= W (v^i - \beta^i/\alpha).
\end{aligned}
\end{equation}

\subsubsection{Baryon current conservation law}

The easiest place to start is with the baryon current conservation law, which is
\begin{equation}
\begin{aligned}
0 &= \partial_a \big[ \sqrt{|g|} J^{a} \big] \\
&= \partial_a \big[ \alpha \sqrt{\gamma} \rho u^a \big] \\
0 &= \partial_t (\sqrt{\gamma} D) + \partial_i \big[ \sqrt{\gamma} D (\alpha v^i - \beta^i) \big] \\
\end{aligned}
\end{equation}
where we have defined the conserved baryon density
\begin{equation}
D \equiv \rho W.
\end{equation}

\subsubsection{Momentum conservation law}

Rezzolla and Zanotti \cite{RezzollaZanotti} first decompose the stress-energy tensor with respect to the normal vector $n^a$ to get
\begin{equation}
\begin{aligned}
T^{ab} &= E n^a n^b + S^a n^b + S^b n^a + S^{ab} \\
&= (e+p) u^a u^b + p g^{ab} \\
&= (e+p) W (n^a + v^a) W (n^b + v^b) + p (\gamma^{ab} - n^a n^b) \\
&= (\rho h W^2 - p) n^a n^b + \rho h W^2 n^a v^b + \rho h W^2 v^a n^b + [\rho h W^2 v^a v^b + p \gamma^{ab}] \\
\end{aligned}
\end{equation}
which implies the components are
\begin{equation}
\begin{aligned}
E &= \rho h W^2 - p \\
S^{a} &= \rho h W^2 v^a \\
S^{ab} &= \rho h W^2 v^a v^b + p \gamma^{ab},
\end{aligned}
\end{equation}
where
\begin{equation}
\rho h = e + p
\end{equation}
defines the specific enthalpy $h$.

We now write the momentum conservation equation as
\begin{equation}
\begin{aligned}
0 &= \partial_a \big[ \sqrt{|g|} T^{a}_{~b} \big] - \frac{1}{2} \sqrt{|g|} T^{ac} \partial_{b} g_{ac} \\
&= \partial_t \big[ \sqrt{|g|} T^{t}_{~j} \big] + \partial_i \big[ \sqrt{|g|} T^{i}_{~j} \big] - \frac{1}{2} \sqrt{|g|} T^{ac} \partial_{j} g_{ac} \\
&= \partial_t \big[ \sqrt{\gamma} S_j \big] + \partial_i \big[ \sqrt{\gamma} (\alpha S^{i}_{~j} - \beta^{i} S_j) \big] - \frac{1}{2} \sqrt{|g|} T^{ac} \partial_{j} g_{ac} \\
\end{aligned}
\end{equation}
which is in the form we want, but the source term needs to be expanded a bit.
It is (note that I've renamed an index):
\begin{equation}
\begin{aligned}
(\textnormal{source}) &= \frac{1}{2} \sqrt{|g|} T^{ab} \partial_{j} g_{ab} \\
&= \sqrt{|g|} (\frac{1}{2} S^{ik} \partial_{j} \gamma_{ik} + S^a n^b \partial_{j} g_{ab} + \frac{1}{2} E n^a n^b \partial_{j} g_{ab}) \\
&= \sqrt{|g|} (\frac{1}{2} S^{ik} \partial_{j} \gamma_{ik} + \frac{1}{\alpha} S_i \partial_{j} \beta^i + \frac{1}{2} E n^a n^b \partial_{j} g_{ab}) \\
\end{aligned}
\end{equation}
where the third line was obtained by doing a computation involving Christoffel symbols, which I haven't done myself (\textbf{TODO: compute it}); see \cite{RezzollaZanotti} equation 7.227.

\subsubsection{Energy conservation equation}

We can now compute the energy conservation equation, which comes from the stress-energy conservation law contracted with the normal vector:
\begin{equation}
\begin{aligned}
0 &= \nabla_a T^{ab} \\
&= \nabla_a (T^{ab} n_b) - T^{ab} \nabla_a n_b \\
&= \nabla_a (E n^a + S^a) + T^{ab} \nabla_a n_b \\
&= \partial_a (\sqrt{|g|} n^a E) + \partial_a (\sqrt{|g|} S^a) + \sqrt{|g|} T^{ab} \nabla_a n_b \\
&= \partial_t (\sqrt{\gamma} E) + \partial_i (\sqrt{\gamma} [\alpha S^i - \beta^i E]) + \sqrt{|g|} T^{ab} \nabla_a n_b \\
\end{aligned}
\end{equation}
the source term can be rewritten as (\cite{RezzollaZanotti} equation 7.229) (\textbf{TODO: compute this})
\begin{equation}
-\sqrt{|g|} T^{ab} \nabla_{a} n_b = \sqrt{|g|} (K_{ij} S^{ij} - S^{i} \partial_{i} \ln \alpha),
\end{equation}
where $K_{ij}$ is the extrinsic curvature.

\subsection{Summary}

Summarizing the results above (and subtracting a copy of the baryon current conservation law from the energy equation to improve numerical accuracy) we find that the conservation law (\ref{eq:RZ_cons_law}) has components
\begin{equation}
\begin{aligned}
\bm{U} =
\begin{pmatrix}
D \\
S_j \\
\tau
\end{pmatrix},~~~
\bm{F}^i =
\begin{pmatrix}
\alpha v^i D - \beta^i D \\
\alpha S^{i}_{~j} - \beta^i S_j \\
\alpha (S^i - D v^i) - \beta^i \tau
\end{pmatrix},~~~
\bm{S} =
\begin{pmatrix}
0 \\
\frac{1}{2} \alpha S^{ik} \partial_j \gamma_{ik} + S_i \partial_j \beta^i - E \partial_j \alpha \\
\alpha S^{ij} K_{ij} - S^j \partial_j \alpha
\end{pmatrix}
\end{aligned}
\end{equation}
where
\begin{align}
D &\equiv \rho W \\
S_j &\equiv \rho h W^2 v_j \\
\tau &\equiv E - D = \rho h W^2 - p - D.
\end{align}

\clearpage

\section{MIS theory with only bulk viscosity}

\subsection{Equations of Motion}

The MIS-bulk equations \cite{Bemfica19} are very similar to the relativistic Euler equations.
The conserved currents are
\begin{align}
T^{ab} &= e u^a u^b + (p + \Pi) \Delta^{ab} \\
J^{a} &= \rho u^a
\end{align}
where $\Delta^{ab} = g^{ab} + u^a u^b$, and the equations of motion are
\begin{align}
0 &= \nabla_{a} T^{ab} \\
0 &= \nabla_{a} J^{a} \\
0 &= \tau_{\Pi} u^a \nabla_a \Pi + \Pi + \lambda \Pi^2 + \zeta \nabla_a u^a, \label{eq:bulk_eq}
\end{align}
where $\tau_{\Pi}, \zeta, \lambda$ are transport coefficients dependent on the state of the flow through $e, n$.

Inspection of the equations above implies that the first two conservation laws are modified only trivially by the addition of bulk viscosity, in that $p \to p + \Pi$.
Unfortunately we gain an additional evolution equation, (\ref{eq:bulk_eq}), which is not conservative.
Even worse, it has a term proportional to the divergence of the flow velocity which will include time derivatives of $u^a$ if this equation is solved as written, complicating the solution scheme.

\subsection{Handling the conservation laws}

The conservation laws are, fortunately, quite similar to those for the relativistic Euler equations.
The only change appears in the 3+1 decomposition of the stress-energy tensor, which becomes:
\begin{equation}
\begin{aligned}
T^{ab} &= E n^a n^b + S^a n^b + S^b n^a + S^{ab} \\
&= e u^a u^b + [p+\Pi] (u^a u^b + g^{ab}) \\
&= [e+p+\Pi] u^a u^b + [p+\Pi] g^{ab} \\
&= [e+p+\Pi] W (n^a + v^a) W (n^b + v^b) + [p+\Pi] (\gamma^{ab} - n^a n^b) \\
&= ([e+p+\Pi] W^2 - [p+\Pi]) n^a n^b + [e+p+\Pi] W^2 n^a v^b + [e+p+\Pi] W^2 v^a n^b \\
&+ \Big( [e+p+\Pi] W^2 v^a v^b + [p+\Pi] \gamma^{ab} \Big) \\
\end{aligned}
\end{equation}
which implies the components are
\begin{equation}
\begin{aligned}
E      &= [e+p+\Pi] W^2 - [p+\Pi] \\
S^a    &= [e+p+\Pi] W^2 v^a \\
S^{ab} &= [e+p+\Pi] W^2 v^a v^b + [p+\Pi] \gamma^{ab}
\end{aligned}
\end{equation}
which recover the relativistic Euler equations in the limit $\Pi \to 0$.

The calculation is otherwise precisely the same as in the relativistic Euler case, so we find conservation laws
\begin{equation}
\begin{aligned}
\bm{U} =
\begin{pmatrix}
D \\
S_j \\
\tau
\end{pmatrix},~~~
\bm{F}^i =
\begin{pmatrix}
\alpha v^i D - \beta^i D \\
\alpha S^{i}_{~j} - \beta^i S_j \\
\alpha (S^i - D v^i) - \beta^i \tau
\end{pmatrix},~~~
\bm{S} =
\begin{pmatrix}
0 \\
\frac{1}{2} \alpha S^{ik} \partial_j \gamma_{ik} + S_i \partial_j \beta^i - E \partial_j \alpha \\
\alpha S^{ij} K_{ij} - S^j \partial_j \alpha
\end{pmatrix}
\end{aligned}
\end{equation}
where
\begin{align}
D &\equiv \rho W \\
S_j &\equiv [e+p+\Pi] W^2 v_j \\
\tau &\equiv [e+p+\Pi] W^2 - [p+\Pi] - D.
\end{align}

\subsection{Handling the $\Pi$ equation}

\subsubsection{Computing $\partial_t W$}

All of the trouble with the $\Pi$ equation comes from the time derivative in the term $\zeta \nabla_a u^a$; expanding it out, we find:
\begin{equation}
\begin{aligned}
\nabla_a u^a &= \frac{1}{\sqrt{|g|}} \partial_{a} (\sqrt{|g|} u^a) \\
&= \frac{1}{\sqrt{|g|}} \partial_{t} (\sqrt{|g|} u^t) + \frac{1}{\sqrt{|g|}} \partial_{i} (\sqrt{|g|} u^i) \\
&= \frac{1}{\alpha \sqrt{|\gamma|}} \partial_{t} \Big( \alpha \sqrt{|\gamma|} \frac{W}{\alpha} \Big) + \frac{1}{\sqrt{|g|}} \partial_{i} (\sqrt{|g|} u^i) \\
&= \frac{1}{\alpha} \partial_{t} ( W ) + \frac{W}{\alpha \sqrt{|\gamma|}} \partial_{t} ( \sqrt{|\gamma|} ) + \frac{1}{\sqrt{|g|}} \partial_{i} (\sqrt{|g|} u^i) \\
&= \frac{1}{\alpha} \partial_{t} ( W ) + u^t \partial_{t} \ln( \gamma^{1/2} ) + \frac{1}{\sqrt{|g|}} \partial_{i} (\sqrt{|g|} u^i). \\
\end{aligned}
\end{equation}
The problem lies entirely with computing the first term, as the second can be written entirely in terms of spatial derivatives of the metric via
\begin{equation}
\partial_t \ln(\gamma^{1/2}) = -\alpha K + D_i \beta^i,
\end{equation}
where $K$ is the trace of the extrinsic curvature, $D_i \equiv \gamma_{a}^{~b} \nabla_{b}$, and $\beta^i$ is the shift vector.

We will now work out the time derivative of the Lorentz factor in $3+1$ form, following \cite{Servignat22}.
We begin with the definition of the Lorentz factor in terms of the Eulerian velocity $v^i$ (\cite{RezzollaZanotti} equation 7.21): 
\begin{equation}
\begin{aligned}
W &= (1 - v_i v^i)^{-1/2} \\
\implies W^{-2} &= 1 - \gamma^{ij} v_i v_j;
\end{aligned}
\end{equation}
taking a time derivative of both sides yields
\begin{equation}
\begin{aligned}
\partial_t W^{-2} &= \partial_t ( 1 - \gamma^{ij} v_i v_j ) \\
\partial_t W &= \frac{1}{2} W^3 \partial_t ( \gamma^{ij} v_i v_j ) \\
&= \frac{1}{2} W^3 \Big( v_i v_j \partial_t \gamma^{ij} + 2 v^j \partial_t v_j \Big) \\
\end{aligned}
\end{equation}
in agreement with \cite{Servignat22} equation 29.

\vspace{3mm}\textbf{TODO:}
\begin{enumerate}
\item compute evolution equation for the inverse spatial metric following \cite{BaumgarteShapiro}
\item write out $\Pi$ evolution equation in coordinate component form
\item code everything up into standard Mathematica and solve for $\partial_t W$
\item check that \cite{Servignat22}'s equation 31 agrees with our result
\end{enumerate}




\clearpage

\begin{thebibliography}{10}
\bibitem{Deppe22} Deppe, N., et al. \url{https://arxiv.org/abs/2109.12033}
\bibitem{BaumgarteShapiro} Baumgarte, T. \& Shapiro, S.
\bibitem{RezzollaZanotti} Rezzolla, L. \& Zanotti, O.
\bibitem{Bemfica19} Bemfica, F., Disconzi, M., \& Noronha, J. \url{https://arxiv.org/abs/1901.06701}
\bibitem{Servignat22} Servignat, G., Novak, J., Cordero-Carri\'on, I., \url{https://arxiv.org/abs/2212.10853}
\end{thebibliography}

\appendix

\clearpage

\section{Warm-up: perfect fluid hydrodynamics}

The natural place to start is with perfect fluid hydrodynamics.

We will start with the metric in $(3+1)$ form,
\begin{equation}
ds^2 = - \alpha^2 dt^2 + \gamma_{ij} (dx^i + \beta^i dt) (dx^j + \beta^j dt)
\end{equation}
where $\alpha$ is the lapse, $\beta^{i}$ is the shift vector, and $\gamma_{ij}$
is the spatial metric, and they use the convention where the indices $i,j,k$
are spatial and $a,b,c$ are spacetime.
The conserved currents are
\begin{align}
T^{ab} &= e u^a u^b + p \Delta^{ab} \\
J^{a} &= \rho u^a
\end{align}
where we have used $\rho = m n$, placing the $m$ back explicitly, and
\begin{equation}
\Delta \equiv u^a u^b + g^{ab}.
\end{equation}
The conservation laws are then
\begin{align}
0 &= \nabla_{a} T^{ab} \\
0 &= \nabla_{a} J^{a}.
\end{align}

\subsection{EOM in conservation-law form}

We now wish to write the equations of motion (EOM) in conservation-law form.
Following \cite{BaumgarteShapiro}, we will cast everything into the form of the conservation law
\begin{equation}
\partial_t U + \partial_i F^{i} = S.
\end{equation}

Let's begin by rewriting the conservation laws with only partial derivatives via
\begin{align}
\partial_a \big[ \sqrt{|g|} T^{ab} \big] &= -\sqrt{|g|} \Gamma^{b}_{a \lambda} T^{a \lambda} \\
\partial_a \big[ \sqrt{|g|} J^{a} \big] &= 0.
\end{align}

We will now work out the components explicitly.
Starting with the baryon current, we have
\begin{equation}
\begin{aligned}
0 &= \partial_a \big[ \sqrt{|g|} J^{a} \big] \\
&= \partial_a \big[ \alpha \sqrt{\gamma} n u^a \big] \\
0 &= \partial_t \tilde{D} + \partial_i \big[ \tilde{D} v^i \big] \\
\end{aligned}
\end{equation}
where we have defined
\begin{equation}
\begin{aligned}
\tilde{D} &\equiv \sqrt{\gamma} \rho W \\
v^{i} &\equiv \frac{u^i}{u^t}.
\end{aligned}
\end{equation}

Moving on to the stress-energy conservation equation, we will begin with the energy equation with the second index lowered
\begin{equation}
\begin{aligned}
0 &= \nabla_{a} T^{a}_{~b} \\
&= \partial_a T^{a}_{~b} + \Gamma^{a}_{a \lambda} T^{\lambda}_{~b} - \Gamma^{\lambda}_{ab} T^{a}_{~\lambda} \\
&= \sqrt{|g|} \partial_a T^{a}_{~b} + T^{a}_{~b} \partial_{a} \sqrt{|g|} - \sqrt{|g|} \Gamma^{\lambda}_{ab} T^{a}_{~\lambda} \\
&= \partial_a \Big( \sqrt{|g|} T^{a}_{~b} \Big) - \sqrt{|g|} \Gamma^{\lambda}_{ab} T^{a}_{~\lambda} \\
&= \partial_t \Big( \sqrt{|g|} T^{t}_{~j} \Big) + \partial_i \Big( \sqrt{|g|} T^{i}_{~j} \Big) - \sqrt{|g|} \Gamma^{\lambda}_{ab} T^{a}_{~\lambda} \\
&= \partial_t \Big( \sqrt{|g|} T^{t}_{~j} \Big) + \partial_i \Big( \sqrt{|g|} T^{i}_{~j} \Big) - \sqrt{|g|} \Gamma^{\lambda}_{ab} g_{c \lambda} T^{a c} \\
&= \partial_t \Big( \sqrt{|g|} T^{t}_{~j} \Big) + \partial_i \Big( \sqrt{|g|} T^{i}_{~j} \Big) - \frac{1}{2} \sqrt{|g|} T^{ac} \partial_{j} g_{ac} \\
&= \partial_t \tilde{S}_j + \partial_i \Big( \alpha \sqrt{\gamma} T^{i}_{~j} \Big) - \frac{1}{2} \alpha \sqrt{\gamma} T^{ac} \partial_{j} g_{ac} \\
\end{aligned}
\end{equation}
where we have used the identity
\begin{equation}
\begin{aligned}
0 &= \nabla_{d} g_{ef} \\
&= \partial_{d} g_{ef} - \Gamma^{\lambda}_{df} g_{e \lambda} - \Gamma^{\lambda}_{ef} g_{d \lambda} \\
%\implies &= \frac{1}{2} \sqrt{|g|} \Big[ - \Gamma^{\lambda}_{df} g_{e \lambda} T^{d e} - \Gamma^{\lambda}_{ef} g_{d \lambda} T^{e d} \Big]
\end{aligned}
\end{equation}
where the second two terms become the same when contracted with $T^{ac}$ as above, and we have defined
\begin{equation}
\tilde{S}_j \equiv \alpha \sqrt{\gamma} T^{t}_{~j}.
\end{equation}

The third equation comes in two parts.
The first step involves computing the normal projection of the stress-energy conservation law:
\begin{equation}
\begin{aligned}
0 &= n_b \partial_a \big[ \sqrt{|g|} T^{ab} \big] + n_b \sqrt{|g|} \Gamma^{b}_{a \lambda} T^{a \lambda} \\
&= n_t \partial_a \big[ \sqrt{|g|} T^{at} \big] + n_t \sqrt{|g|} \Gamma^{t}_{a \lambda} T^{a \lambda} + n_j \partial_a \big[ \sqrt{|g|} T^{aj} \big] + n_j \sqrt{|g|} \Gamma^{j}_{a \lambda} T^{a \lambda} \\
&= \partial_a \big[ \alpha \sqrt{|g|} T^{at} \big] + \alpha \sqrt{|g|} \Gamma^{t}_{a \lambda} T^{a \lambda} - \sqrt{|g|} T^{at} \partial_a \alpha \\
&= \partial_t \big[ \alpha^2 \sqrt{\gamma} T^{tt} \big] + \partial_i \big[ \alpha^2 \sqrt{\gamma} T^{it} \big] + \alpha \sqrt{|g|} \Gamma^{t}_{a \lambda} T^{a \lambda} - \sqrt{|g|} T^{at} \partial_a \alpha \\
\end{aligned}
\end{equation}
and then we subtract off a copy of the baryon current conservation law
\begin{equation}
\begin{aligned}
0 &= \partial_t \tilde{\tau} + \partial_i \big[ \alpha^2 \sqrt{\gamma} T^{it} - \tilde{D} v^i \big] + \alpha \sqrt{|g|} \Gamma^{t}_{a \lambda} T^{a \lambda} - \sqrt{|g|} T^{at} \partial_a \alpha \\
&= \partial_t \tilde{\tau} + \partial_i \big[ \alpha^2 \sqrt{\gamma} T^{it} - \tilde{D} v^i \big] - \alpha \sqrt{\gamma} (T^{at} \partial_a \alpha - \alpha \Gamma^{t}_{a \lambda} T^{a \lambda}) \\
\end{aligned}
\end{equation}
and we have defined
\begin{equation}
\tilde{\tau} \equiv \alpha^2 \sqrt{\gamma} T^{tt} - \tilde{D}.
\end{equation}

Altogether the conservation law can be written in component form as
\begin{equation} \label{eq:Baumgarte_cons_comps}
U =
\begin{pmatrix}
\tilde{D} \\
\tilde{S}_j \\
\tilde{\tau}
\end{pmatrix},~~~
F^{i} =
\begin{pmatrix}
\tilde{D} v^i \\
\alpha \sqrt{\gamma} T^{i}_{~j} \\
\alpha^2 \sqrt{\gamma} T^{it} - \tilde{D} v^i
\end{pmatrix},~~~
S =
\begin{pmatrix}
0 \\
\frac{1}{2} \alpha \sqrt{\gamma} T^{ac} \partial_{j} g_{ac} \\
\alpha \sqrt{\gamma} (T^{at} \partial_a \alpha - \alpha \Gamma^{t}_{a \lambda} T^{a \lambda})
\end{pmatrix},
\end{equation}
which agrees with \cite{BaumgarteShapiro}.

\section{Warm-up: GRMHD}

To get used to the form of the equations solved in SpECTRE, we'll work out the
 equations of GRMHD following \cite{Deppe22}.
They start with the metric in $(3+1)$ form,
\begin{equation}
ds^2 = - \alpha^2 dt^2 + \gamma_{ij} (dx^i + \beta^i dt) (dx^j + \beta^j dt)
\end{equation}
where $\alpha$ is the lapse, $\beta^{i}$ is the shift vector, and $\gamma_{ij}$
 is the spatial metric, and they use the convention where the indices $i,j,k$
 are spatial and $a,b,c$ are spacetime.

\subsection{Basics of MHD}

In general, the Faraday tensor can be written
\begin{equation}
F^{ab} = n^a E^b - n^b E^a + n_d \epsilon^{dabc} B_c,
\end{equation}
where $E^a, B^a$ are four-vectors containing the components of the electric and magnetic fields (respectively) as seen by a normal observer $n^a$.
Both of these vectors are purely spatial, so
\begin{equation}
E^a n_a = B^a n_a = 0,
\end{equation}
and one finds that they can be recovered from $F^{ab}$ via
\begin{equation}
\begin{aligned}
n_b F^{ab} &= n_b (n^a E^b - n^b E^a + n_d \epsilon^{dabc} B_c) \\
&= 0 - (-1) E^a + n_b n_d \epsilon^{dabc} B_c \\
&= E^{a}
\end{aligned}
\end{equation}
where we have used the fact that $n_a$ is timelike, $E^{a}$ is purely spatial, and that $n_b n_d$ is a symmetric $2$-tensor contracted with the totally antisymmetric tensor $\epsilon^{dabc}$ so the contraction yields zero.
Similarly, 
\begin{equation}
\begin{aligned}
\frac{1}{2} \epsilon^{abcd} n_b F_{dc} &= \frac{1}{2} \epsilon^{abcd} n_b (n_d E_c - n_c E_d + n^e \epsilon_{edcf} B^f) \\
&= \frac{1}{2} \epsilon^{abcd} n_b n^e \epsilon_{edcf} B^f \\
&= B^a \\
\end{aligned}
\end{equation}
where we have used the identity $\epsilon_{abcd} \epsilon^{abkl} = 2 (\delta^{k}_{c} \delta^{l}_{d} - \delta^{l}_{c} \delta^{k}_{d})$ and the fact that $B^a$ is purely spatial to obtain the final line.

The EM stress-energy tensor is written
\begin{equation}
T^{ab}_{EM} = \frac{1}{\mu_0} \Big[ F^{a c} F^{b}_{~c} - \frac{1}{4} g^{ab} F_{cd} F^{cd} \Big],
\end{equation}
where \cite{BaumgarteShapiro,Deppe22} use the Gaussian-CGS unit convention where $\mu_0 = 4 \pi$.

\subsection{Ideal MHD}

We will now specialize to \textit{ideal MHD}, by which we mean that the fluid has perfect electrical conductivity.
This statement means that if a net charge is ever sourced, fluid should move such that the charge gets screened instantaneously---in other words, we should find that in the rest frame of the fluid, the electric field vanishes, i.e. 
\begin{equation}
\begin{aligned}
0 &= u_a E^{a} \\
0 &= u_a (n_b F^{ab}) \\
\implies 0 &= u_{a} F^{ab}, ~~~~~~~~\textnormal{(ideal MHD assumption)}
\end{aligned}
\end{equation}
because $n_b$ is non-vanishing.

%For a co-moving observer $n_a = u_a$ and the electric field vanishes, so we can write $F^{ab}$ in a particularly simple form:
%\begin{equation}
%F^{ab} = u_d \epsilon^{abcd} B_{c}^{(u)}. 
%\end{equation}
The fact that the ideal MHD assumption specifies the electric field in the rest frame of the fluid flow implies that we now have two different reference frames to keep track of, namely the coordinate frame defined with respect to $n^a$ and the flow frame defined with respect to $u^a$.
We'll need the relationship between the $E, B$ fields between the two frames, which is given by \cite{BaumgarteShapiro} to be
\begin{align}
E^{a} &= -\epsilon^{abc} u_b B^{(u)}_{c} \\
B^{a} &= -n_b u^b B^{a}_{(u)} + n_b B^{b}_{(u)} u^a,
\end{align}
where the subscript $(u)$ appears on quantities in the fluid rest frame, and we have defined the purely spatial Levi-Civita tensor via
\begin{equation}
\epsilon^{abc} = n_d \epsilon^{dabc}.
\end{equation}

We now introduce the dual to the Faraday tensor,
\begin{equation}
F^{*ab} = \frac{1}{2} \epsilon^{abcd} F_{cd},
\end{equation}
which implies that in the flow frame
\begin{equation} \label{eq:Fstar_Bflow}
\begin{aligned}
F^{*ab} &= \frac{1}{2} \epsilon^{abcd} (n_c E_d - n_d E_c + n^e \epsilon_{ecdf} B^f) \\
&= \frac{1}{2} \epsilon^{abcd} \Big( n_c [-\epsilon_{def} u^e B_{(u)}^{f}] - n_d [-\epsilon_{cef} u^e B_{(u)}^{f}] + n^e \epsilon_{ecdf} [-n_g u^g B^{f}_{(u)} + n_g B^{g}_{(u)} u^f] \Big) \\
&= n_g \Big[ u^g (+ n^a B^{b}_{(u)} - n^b B^{a}_{(u)}) + B^{g}_{(u)} (n^b u^a - n^a u^b) \Big] \\
&= u^b B^{a}_{(u)} - u^a B^{b}_{(u)}, \\
\end{aligned}
\end{equation}
where we have used the fact that $n_a = u_a$ in the flow frame to arrive at the final line.

The Maxwell equations of motion are
\begin{equation}
\nabla_{a} F^{ab} = 0
\end{equation}
which implies
\begin{equation} \label{eq:maxwell_eq}
\nabla_{a} F^{*ab} = 0
\end{equation}
and we can substitute (\ref{eq:Fstar_Bflow}) into (\ref{eq:maxwell_eq}) to find
\begin{equation} \label{eq:maxwell_eq_Bu}
\begin{aligned}
0 &= \nabla_{a} F^{*ab} \\
&= \nabla_{a} (u^b B^{a}_{(u)} - u^a B^{b}_{(u)}) \\
&= \frac{1}{\sqrt{|g|}} \partial_{a} (\sqrt{|g|} [u^b B^{a}_{(u)} - u^a B^{b}_{(u)}]) \\
&= \partial_{a} \Big( W \sqrt{\gamma} [v^b B^{a}_{(u)} - v^a B^{b}_{(u)}] \Big) \\
\end{aligned}
\end{equation}
where we have used the identity $\sqrt{|g|} = \alpha \sqrt{\gamma}$, where $\gamma$ is the determinant of the spatial metric, and $\nabla_{a} X^{ab} = |g|^{-1/2} \partial_a (\sqrt{|g|} X^{ab})$, which only holds true if $X^{ab}$ is antisymmetric as is the case here, and defined
\begin{equation}
v^a \equiv \frac{u^a}{u^t}.
\end{equation}

The equation (\ref{eq:maxwell_eq_Bu}) is more commonly written
\begin{equation}
0 = \partial_{a} \Big( W \sqrt{\gamma} [v^b b^{a} - v^a b^{b}] \Big)
\end{equation}
where we have defined
\begin{equation} \label{eq:ba}
b^{a} \equiv \frac{B^{a}_{(u)}}{\sqrt{4 \pi}}.
\end{equation}
Notice that $b^a$ obeys the orthogonality relation $u_a b^a = 0$.

\subsection{EOM in covariant form}

The equations of motion for ideal (infinite conductivity) GRMHD are
\begin{align}
0 &= \nabla_{a} J^{a}    \\
0 &= \nabla_{a} T^{ab}   \\
0 &= \nabla_{a} F^{*ab},
\end{align}
where the conserved currents are
\begin{align}
J^{a} &= n u^a \\
T^{ab} &= \Big( e + \frac{1}{2} b_c b^c \Big) u^a u^b + \Big( p + \frac{1}{2} b_c b^c \Big) \Delta^{ab} - b^a b^b  \\
F^{*ab} &= \sqrt{4 \pi} [u^b b^{a} - u^a b^{b}]
\end{align}
where
\begin{equation}
\Delta^{ab} = u^a u^b + g^{ab}
\end{equation}
and $e$ is the energy density, $p$ is the pressure of the fluid.

\subsection{EOM in flux-conservative form}

\section{Old stuff}

\subsection{MIS-bulk EOM}

The goal of this section is to derive the MIS-bulk EOM so that the evolution equation for $\Pi$ is free of time derivatives of $e, u^a$.
We will do this by writing out the EOM as they appear in \cite{Bemfica19} equations 2-5.

The easiest equation is their equation 5, the baryon current conservation law:
\begin{equation}
\begin{aligned}
0 &= \nabla_{a} J^{a} \\
&= \nabla_{a} (\rho u^a) \\
&= \rho \nabla_{a} u^a + u^a \nabla_{a} \rho. \\
\end{aligned}
\end{equation}

Next we will consider the projection of the stress-energy conservation law along $u_b$:
\begin{equation}
\begin{aligned}
0 &= u_b \nabla_{a} T^{ab} \\
&= u_b \nabla_{a} [e u^a u^b + (p + \Pi) \Delta^{ab}] \\
&= u_b \nabla_{a} (e u^a u^b) + u_b \nabla_{a} [(p + \Pi) (g^{ab} + u^a u^b)] \\
&= u^a \nabla_{a} e + [e + p + \Pi] \nabla_{a} u^a \\
\end{aligned}
\end{equation}
in agreement with \cite{Bemfica19} equation 2.

Next is the projection orthogonal to the flow velocity, which is
\begin{equation}
\begin{aligned}
0 &= \Delta_{bc} \nabla_{a} T^{ab} \\
&= \Delta_{bc} \nabla_{a} [e u^a u^b + (p + \Pi) \Delta^{ab}] \\
&= e u^a \nabla_{a} u_c + (p + \Pi) u^a \nabla_{a} u_c + \Delta^{a}_{~c} \nabla_{a} p + \Delta^{a}_{~c} \nabla_{a} \Pi \\
&= (e + p + \Pi) u^a \nabla_{a} u_c + \alpha_1 \Delta^{a}_{~c} \nabla_a e + \alpha_2 \Delta^{a}_{~c} \nabla_a \rho + \Delta^{a}_{~c} \nabla_{a} \Pi \\
\end{aligned}
\end{equation}
where we have defined
\begin{align}
\alpha_1 &\equiv \frac{\partial p}{\partial e} \Big|_\rho \\
\alpha_2 &\equiv \frac{\partial p}{\partial \rho} \Big|_e
\end{align}
in agreement with \cite{Bemfica19} equation 3.

\subsection{MIS-bulk as a FOSH system}

\subsubsection{Equations in covariant form}

We will begin by writing the equations in the form
\begin{equation}
0 = \mathcal{M}^a \nabla_a \Psi + \mathcal{N} \Psi,
\end{equation}
where $\Psi = (e, u^b, \rho, \Pi)$ is the state vector.

To write the equations in this form we will have to manipulate the EOM slightly; doing so yields
\begin{equation}
\begin{aligned}
0 &= u^a \nabla_{a} e + [e + p + \Pi] \delta^{a}_{c} \nabla_{a} u^c \\
0 &= \alpha_1 \Delta^{ac} \nabla_a e + (e + p + \Pi) u^a \nabla_{a} u^c + \alpha_2 \Delta^{ac} \nabla_a \rho + \Delta^{ac} \nabla_{a} \Pi \\
0 &= \rho \delta^{a}_{c} \nabla_{a} u^c + u^a \nabla_{a} \rho \\
0 &= \zeta \delta^{a}_{c} \nabla_a u^c + \tau_{\Pi} u^a \nabla_a \Pi + \Pi + \lambda \Pi^2 \\
\end{aligned}
\end{equation}
and we can read off $\mathcal{M}^{a}, \mathcal{N}$:
\begin{equation}
\mathcal{M}^{a} =
\begin{pmatrix}
u^a & (e+p+\Pi) \delta^{a}_{c} & 0 & 0 \\
\alpha_1 \Delta^{ac} & (e+p+\Pi) u^a & \alpha_2 \Delta^{ac} & \Delta^{ac} \\
0 & \rho \delta^{a}_{c} & u^a & 0 \\
0 & \zeta \delta^{a}_{c} & 0 & \tau_{\Pi} u^a \\
\end{pmatrix},~~~
\mathcal{N} =
\begin{pmatrix}
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 1 + \lambda \Pi
\end{pmatrix}
\end{equation}
which agrees with the appendix of \cite{Bemfica19}.

%\clearpage

\subsubsection{Equations in FOSH form}

We now want to write the system in first-order symmetric hyperbolic (FOSH) form, i.e.
\begin{equation}
\mathcal{A}^{a} \partial_{a} \Phi + \mathcal{B}(\Phi) = F,
\end{equation}
where $\Phi = (e, u^i, \rho , \Pi)$ and $\mathcal{A}^a$ is matrix-valued for each value of the index $a$, and $\mathcal{B}, F$ are vectors.

It is critical to note that the state vector contains only spatial components of the four-velocity, $u^i$, so we'll have to eliminate derivatives of the time component $\partial_a u^t$.
We can do this using the condition that $u^a$ is timelike:
\begin{equation}
\begin{aligned}
-1 &= g_{ab} u^a u^b \\
-1 &= g_{tt} (u^t)^2 + g_{ti} u^t u^i + g_{jt} u^j u^t + g_{ij} u^i u^j \\
-1 &= g_{tt} (u^t)^2 + 2 g_{ti} u^t u^i + g_{ij} u^i u^j \\
\partial_{a} (-1) &= \partial_{a} \Big[ g_{tt} (u^t)^2 + 2 g_{ti} u^t u^i + g_{ij} u^i u^j \Big] \\
0 &= \partial_{a} [g_{tt} (u^t)^2] + 2 \partial_{a} [g_{ti} u^t u^i] + \partial_{a} [g_{ij} u^i u^j] \\
&= (2 g_{tt} u^t + 2 g_{ti} u^i) \partial_{a} u^t \\
&+ (2 g_{ti} u^t + 2 g_{ij} u^j) \partial_{a} u^i \\
&+ (u^t)^2 \partial_{a} g_{tt} + 2 u^t u^i \partial_{a} g_{ti} + u^i u^j \partial_{a} g_{ij} \\
&= (2 g_{tt} u^t + 2 g_{ti} u^i) \partial_{a} u^t + (2 g_{ti} u^t + 2 g_{ij} u^j) \partial_{a} u^i + u^c u^d \partial_{a} g_{cd} \\
\end{aligned}
\end{equation}

\noindent\textbf{old stuff below}

\begin{equation}
\begin{aligned}
0 &= \rho \nabla_{a} u^a + u^a \nabla_{a} \rho \\
&= \frac{\rho}{\sqrt{|g|}} \partial_{a} (\sqrt{|g|} u^a) + u^a \partial_{a} \rho \\
&= \rho \partial_{a} u^a + u^a \partial_{a} \rho + \rho u^a \partial_{a} \ln(\sqrt{|g|}) \\
\end{aligned}
\end{equation}
the energy equation is
\begin{equation}
\begin{aligned}
0 &= u^a \nabla_{a} e + [e + p + \Pi] \nabla_{a} u^a \\
&= u^a \partial_{a} e + \frac{[e + p + \Pi]}{\sqrt{|g|}} \partial_{a} (\sqrt{|g|} u^a) \\
&= u^a \partial_{a} e + [e + p + \Pi] \partial_{a} u^a + [e + p + \Pi] u^a \partial_{a} \ln(\sqrt{|g|}) \\
\end{aligned}
\end{equation}
the $\Pi$ equation is
\begin{equation}
\begin{aligned}
0 &= \tau_{\Pi} u^a \nabla_a \Pi + \Pi + \lambda \Pi^2 + \zeta \nabla_a u^a \\
&= \tau_{\Pi} u^a \partial_a \Pi + \zeta \partial_a u^a + \Pi + \lambda \Pi^2 + \zeta u^a \partial_a \ln(\sqrt{|g|}) \\
\end{aligned}
\end{equation}
The momentum equations are (notice the free index $c$)
\begin{equation}
\begin{aligned}
0 &= (e + p + \Pi) u^a \nabla_{a} u^c + \alpha_1 \Delta^{ac} \nabla_a e + \alpha_2 \Delta^{ac} \nabla_a \rho + \Delta^{ac} \nabla_{a} \Pi \\
&= (e + p + \Pi) u^a \partial_{a} u^c + \alpha_1 \Delta^{ac} \partial_a e + \alpha_2 \Delta^{ac} \partial_a \rho + \Delta^{ac} \partial_{a} \Pi + (e + p + \Pi) \Gamma^{c}_{ad} u^a u^d \\
\end{aligned}
\end{equation}

\end{document}
